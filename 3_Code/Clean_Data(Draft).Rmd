---
title: "Clean_Data"
author: "czx"
date: "`r Sys.Date()`"
output: html_document
---

#变量名称查询工具

```{r}
# 设置工作目录，即文件所在的文件夹
setwd("D:/GitHub_programe/GitHub/SPE_Database/4_Data_Extraction/4_2_Open_Data/Paper_95/Raw_Data")

# 读取CSV文件
data <- read.csv("P95_Exp1_raw.csv")

# 打印变量名称
print(names(data))

```

```{r Package, warning = FALSE,message = FALSE}
# clean data
library(tidyr)
library(dplyr)
library(stringr)
library(R.matlab) # Paper s4 is from MATLAB
library(data.table) # some functions need it
# for ICC
library(psych)

# # for DDM
# library(hausekeep) # ez ddm
# library(RWiener) # RW ddm
# Plot
library(ggplot2)
library(see)
library(patchwork)
# Parallel Computing
library(foreach)
library(parallel)
library(iterators)
library(doParallel)
# Meta Analysis
#library(metafor) 
library(AATtools)
```

```{r Matlab小工具}
# Read MATLAB .mat

read.mat <- function(list) {
  
  res <- list()
  
  for (i in 1:length(list)) {

    list_mat <- list[[i]]

    df_rt <- data.frame(
      RT_1 = list_mat$TestRt[,1],
      RT_2 = list_mat$TestRt[,2],
      RT_3 = list_mat$TestRt[,3],
      RT_4 = list_mat$TestRt[,4]
      ) %>%
      tidyr::pivot_longer(
        cols = starts_with("RT_"),
        names_to = "Block",
        names_prefix = "RT_",
        values_to = "RT"
      ) 
      
    df_acc <- data.frame(
      ACC_1 = list_mat$Correct[, 1],
      ACC_2 = list_mat$Correct[, 2],
      ACC_3 = list_mat$Correct[, 3],
      ACC_4 = list_mat$Correct[, 4]
      ) %>%
      tidyr::pivot_longer(
        cols = starts_with("ACC_"),
        names_to = "Block",
        names_prefix = "ACC_",
        values_to = "ACC"
      ) %>%
      dplyr::select(-Block)
    
    df_sha <- data.frame(
      Shape_1 = list_mat$Tshape[, 1],
      Shape_2 = list_mat$Tshape[, 2],
      Shape_3 = list_mat$Tshape[, 3],
      Shape_4 = list_mat$Tshape[, 4]
      ) %>%
      tidyr::pivot_longer(
        cols = starts_with("Shape_"),
        names_to = "Block",
        names_prefix = "Shape_",
        values_to = "Shape"
      ) %>%
      dplyr::select(-Block)
    
    df_lab <- data.frame(
      Label_1 = list_mat$Tlabel[, 1],
      Label_2 = list_mat$Tlabel[, 2],
      Label_3 = list_mat$Tlabel[, 3],
      Label_4 = list_mat$Tlabel[, 4]
      ) %>%
      tidyr::pivot_longer(
        cols = starts_with("Label_"),
        names_to = "Block",
        names_prefix = "Label_",
        values_to = "Label"
      ) %>%
      dplyr::select(-Block)
    
    df_mat <- data.frame(
      Subject = list_mat$num,
      Session = list_mat$ses,
      df_sha, df_lab,
      df_rt, df_acc
    )
    
    res[[i]] <- df_mat
  }

  df <- do.call(rbind, res)

  return(df)

}
```


# Data.Frame List
```{r Data.Frame List}
df <- list()
```

# Paper 6 
## Experiment 1 (Identtiy = 3)
"Self", "Partner", "Stranger"

```{r Paper 6}
df[[1]] <- read.csv(
  "../../4_Data_Extraction/4_2_Open_Data/Paper_6/Raw_Data/P6_Exp1_raw.csv"
  ) %>%
  dplyr::filter(
    rt != "None"
  ) %>%
  dplyr::select(
    Subject = Pair.Number,
    Matching = Condition,
    Identity = Shape,
    ShapeLoc = ShapeLoc,
    RT_sec = rt,
    ACC = corr,
    Phase = Phase
  ) %>%
  dplyr::mutate(
    Matching = case_when(
      Matching == "Match" ~ "Matching",
      Matching == "Mismatch" ~ "Nonmatching"
    ),
    Identity = case_when(
      Identity == "P1" ~ "Self",
      Identity == "P2" ~ "Partner",
      Identity == "Stranger" ~ "Stranger",
    ),
    RT_sec = as.numeric(RT_sec),
    RT_ms = RT_sec * 1000,
  ) %>%
  dplyr::mutate(
    Subject = as.numeric(Subject),
    Matching = factor(
      Matching, levels = c("Matching", "Nonmatching")
    ),
    Identity = factor(
      Identity, levels = c("Self", "Partner", "Stranger")
    ),
    ShapeLoc = case_when(
      ShapeLoc == "Top" ~ 1,
      ShapeLoc == "Bottom" ~ 2,
    ),
    ShapeLoc = as.factor(ShapeLoc),
    RT_ms = as.numeric(RT_ms),
    RT_sec = as.numeric(RT_sec),
    ACC = as.numeric(ACC),
  ) %>%
  dplyr::select(
    Subject, Matching, Identity, ShapeLoc, RT_ms, RT_sec, ACC, Phase
  ) %>%
  dplyr::mutate(
    RT_sec = round(RT_sec, 3),
    RT_ms = round(RT_ms, 0)
  ) %>%
  dplyr::filter(
    RT_sec >= 0.2 & RT_sec <= 1.5,
    ACC == 1 | ACC == 0
  ) %>%
  dplyr::arrange(
    Subject, Matching, Identity, ShapeLoc
  )

names(df)[1] <- "Paper 6 Exp 1"
summary(df[[1]])
write.csv(x = df[[1]], file = "../../4_Data_Extraction/4_2_Open_Data/Paper_6/Clean_Data/P6_Exp1_Clean.csv")
```



# Paper 34 
## Experiment 1 (Identtiy = 3)
"Self", "Friend", "Stranger"
```{r Paper 34}
# df[[2]] <- read.csv(
#   "../../4_Data_Extraction/4_2_Open_Data/Paper_34/P34_Exp1_correctRT_raw.csv"
#   ) %>%
#   # 筛选可以分析的行
#   dplyr::filter(
#     reac_time != "None",
#   ) %>%
#   # 选择可以分析的列
#   dplyr::select(
#     Subject =  subid,
#     Matching = matching,
#     Identity = Shape,
#     ShapeLoc = ShapeLoc,
#     RT_sec = rt,
#     ACC = corr,
#   ) %>%
#   # 转化为标准化的名称
#   dplyr::mutate(
#     Matching = case_when(Matching == "Match" ~ "Matching",
#     Matching == "Mismatch" ~ "Nonmatching"),
#     ShapeLoc = case_when(
#       ShapeLoc == "Top" ~ 1,
#       ShapeLoc == "Bottom" ~ 2,
#     ),
#     RT_sec = as.numeric(RT_sec),
#     RT_ms = RT_sec * 1000,
#   ) %>%
#   # 统一变量的属性
#   dplyr::mutate(
#     Subject = as.numeric(Subject),
#     Matching = factor(
#       Matching, levels = c("Matching", "Nonmatching")
#     ),
#     Identity = factor(
#       Identity, levels = c("Self", "Stranger")
#     ),
#     RT_ms = as.numeric(RT_ms),
#     RT_sec = as.numeric(RT_sec),
#     ACC = as.numeric(ACC),
#   ) %>%
#   dplyr::select(
#     Subject, Matching, Identity, ShapeLoc, RT_ms, RT_sec, ACC
#   ) %>%
#   dplyr::mutate(
#     RT_sec = round(RT_sec, 3),
#     RT_ms = round(RT_ms, 0)
#   ) %>%
#   dplyr::filter(
#     RT_sec >= 0.2 & RT_sec <= 1.5,
#     ACC == 1 | ACC == 0
#   ) %>%
#   dplyr::arrange(
#     Subject, Matching, Identity, ShapeLoc
#   )
# 
# names(df)[2] <- "Paper 46 Exp 2"
# summary(df[[2]])
# write.csv(x = df[[2]], file = "../../4_Data_Extraction/4_2_Open_Data/Paper_34/P34_Exp1_Clean.csv")
```


# Paper 46
## Experiment 1 (Identtiy = 2)
"Self", "Stranger"
```{r Paper 46 Experiment 1}
df[[2]] <- read.csv(
  "../../4_Data_Extraction/4_2_Open_Data/Paper_46/Raw_Data/Exp1/P46_Exp1_raw.csv"
  ) %>%
  # 筛选可以分析的行
  dplyr::filter(
    rt != "None",
    Exclude == 0
  ) %>%
  # 选择可以分析的列
  dplyr::select(
    Subject = X1..Participant.Number,
    Matching = Condition,
    Identity = Label,
    ShapeLoc = ShapeLoc,
    RT_sec = rt,
    ACC = corr,
  ) %>%
  # 转化为标准化的名称
  dplyr::mutate(
    Matching = case_when(
    Matching == "Match" ~ "Matching",
    Matching == "Mismatch" ~ "Nonmatching"),
    
    ShapeLoc = case_when(
      ShapeLoc == "Top" ~ 1,
      ShapeLoc == "Bottom" ~ 2,
    ),
    RT_sec = as.numeric(RT_sec),
    RT_ms = RT_sec * 1000,
  ) %>%
  # 统一变量的属性
  dplyr::mutate(
    Subject = as.numeric(Subject),
    Matching = factor(
      Matching, levels = c("Matching", "Nonmatching")
    ),
    Identity = factor(
      Identity, levels = c("Self", "Stranger")
    ),
    RT_ms = as.numeric(RT_ms),
    RT_sec = as.numeric(RT_sec),
    ACC = as.numeric(ACC),
  ) %>%
  dplyr::select(
    Subject, Matching, Identity, ShapeLoc, RT_ms, RT_sec, ACC
  ) %>%
  dplyr::mutate(
    RT_sec = round(RT_sec, 3),
    RT_ms = round(RT_ms, 0)
  ) %>%
  dplyr::filter(
    RT_sec >= 0.2 & RT_sec <= 1.5,
    ACC == 1 | ACC == 0
  ) %>%
  dplyr::arrange(
    Subject, Matching, Identity, ShapeLoc
  )

names(df)[2] <- "Paper 46 Exp 1"
summary(df[[2]])
write.csv(x = df[[2]], file = "../../4_Data_Extraction/4_2_Open_Data/Paper_46/Clean_Data/P46_Exp1_Clean.csv")
```

# Paper 46 (Dark Light Box)
## Experiment 2 (Identtiy = 2)
"Self", "Stranger"
```{r Paper 46 Experiment 2}
df[[3]] <- read.csv(
  "../../4_Data_Extraction/4_2_Open_Data/Paper_46/Raw_Data/Exp2/P46_Exp2_raw.csv"
  ) %>%
  # 筛选可以分析的行
  dplyr::filter(
    rt != "None",
    Exclude == 0
  ) %>%
  # 选择可以分析的列
  dplyr::select(
    Subject = Subject,
    Matching = Condition,
    Identity = Shape,
    ShapeLoc = ShapeLoc,
    RT_sec = rt,
    ACC = corr,
  ) %>%
  # 转化为标准化的名称
  dplyr::mutate(
    Matching = case_when(
    Matching == "Match" ~ "Matching",
    Matching == "Mismatch" ~ "Nonmatching"),
    ShapeLoc = case_when(
      ShapeLoc == "Top" ~ 1,
      ShapeLoc == "Bottom" ~ 2,
    ),
    RT_sec = as.numeric(RT_sec),
    RT_ms = RT_sec * 1000,
  ) %>%
  # 统一变量的属性
  dplyr::mutate(
    Subject = as.numeric(Subject),
    Matching = factor(
      Matching, levels = c("Matching", "Nonmatching")
    ),
    Identity = factor(
      Identity, levels = c("Self", "Stranger")
    ),
    RT_ms = as.numeric(RT_ms),
    RT_sec = as.numeric(RT_sec),
    ACC = as.numeric(ACC),
  ) %>%
  dplyr::select(
    Subject, Matching, Identity, ShapeLoc, RT_ms, RT_sec, ACC
  ) %>%
  dplyr::mutate(
    RT_sec = round(RT_sec, 3),
    RT_ms = round(RT_ms, 0)
  ) %>%
  dplyr::filter(
    RT_sec >= 0.2 & RT_sec <= 1.5,
    ACC == 1 | ACC == 0
  ) %>%
  dplyr::arrange(
    Subject, Matching, Identity, ShapeLoc
  )

names(df)[3] <- "Paper 46 Exp 2"
summary(df[[3]])
write.csv(x = df[[3]], file = "../../4_Data_Extraction/4_2_Open_Data/Paper_46/Clean_Data/P46_Exp2_Clean.csv")
```

# Paper 51 
## Experiment 1 (Identtiy = 3)
"Self", "Celebrity", "Stranger"
```{r Paper 51 Experiment 1}
df[[4]] <- read.csv(
  "../../4_Data_Extraction/4_2_Open_Data/Paper_51/Raw_Data/P51_Exp1_raw.csv"
  ) %>%
  tidyr::separate(
    condition,
    into = c("Identity", "Match"),
    sep = "-shape_"
  ) %>%
  dplyr::mutate(
    Identity = case_when(
      Identity == "Self" ~ "Self",
      Identity == "Familiar" ~ "Celebrity",
      Identity == "Stranger" ~ "Stranger"
    ),
    Matching = case_when(
      Match == "Matched" ~ "Matching",
      Match == "Mismatched" ~ "Nonmatching"
    ),
    Session = case_when(
      Session == "S1" ~ 1,
      Session == "S2" ~ 2,
      Session == "S3" ~ 3,
      Session == "S4" ~ 4
    ),
    Mood = case_when(
      mood == "anxious" ~ 1,
      mood == "depression" ~ 2,
      mood == "happy" ~ 3,
      mood == "serenity" ~ 4
    ),
  RT_ms = as.numeric(respond3.RT),
  RT_sec = RT_ms / 1000,
  ACC = as.numeric(respond3.ACC),
  Arouse = Arouse.RESP,
  Valence = Valence.RESP,
  ) %>%
  dplyr::mutate(
    Subjcet = as.numeric(Subject),
    Matching = factor(
      Matching, levels = c("Matching", "Nonmatching")
    ),
    Identity = factor(
      Identity, levels = c("Self", "Celebrity", "Stranger")
    ),
    Session = as.factor(Session),
    RT_ms = as.numeric(RT_ms),
    RT_sec = as.numeric(RT_sec),
    ACC = as.numeric(ACC),
  ) %>%
  dplyr::select(
    Subject, Matching, Identity, Session, RT_ms, 
    RT_sec, ACC, Mood, Arouse, Valence
  ) %>%
  dplyr::mutate(
    RT_sec = round(RT_sec, 3),
    RT_ms = round(RT_ms, 0)
  ) %>%
  dplyr::filter(
    RT_sec >= 0.2 & RT_sec <= 1.5,
    ACC == 1 | ACC == 0
  ) %>%
  dplyr::arrange(
    Subject, Matching, Identity, Session
  )

names(df)[4] <- "Paper 51 Exp 1"
summary(df[[4]])
write.csv(x = df[[4]], file = "../../4_Data_Extraction/4_2_Open_Data/Paper_51/Clean_Data/P51_Exp1_Clean.csv")
```

## Experiment 2 (Identtiy = 2)
"Self", "Celebrity"
```{r Paper 51 Experiment 2}
df[[5]] <- read.csv(
  "../../4_Data_Extraction/4_2_Open_Data/Paper_51/Raw_Data/P51_Exp2_raw.csv"
  ) %>%
  tidyr::separate(
    condition1correct,
    into = c("Identity", "Matching"),
    sep = "-shape_"
  ) %>%
  dplyr::mutate(
    Subject = Subject,
    Identity = case_when(
      Identity == "Self" ~ "Self",
      Identity == "Familiar" ~ "Celebrity"
    ),
    Matching = case_when(
      Matching == "Matched" ~ "Matching",
      Matching == "Mismatched" ~ "Nonmatching"
    ),
    condition1level = case_when(
      condition1level == "Alter cue" ~ 1,
      condition1level == "No cue" ~ 2
    ),
    RT_ms = as.numeric(respond3.RT),
    RT_sec = RT_ms / 1000,
    ACC = as.numeric(respond3.ACC)
  ) %>%
  dplyr::mutate(
    Subjcet = as.numeric(Subject),
    Matching = factor(
      Matching, levels = c("Matching", "Nonmatching")
    ),
    Identity = factor(
      Identity, levels = c("Self", "Celebrity")
    ),
    RT_ms = as.numeric(RT_ms),
    RT_sec = as.numeric(RT_sec),
    ACC = as.numeric(ACC),
  ) %>%
  dplyr::select(
    Subject, Matching, Identity, RT_ms, RT_sec, ACC, condition1level
  ) %>%
  dplyr::mutate(
    RT_sec = round(RT_sec, 3),
    RT_ms = round(RT_ms, 0)
  ) %>%
  dplyr::filter(
    RT_sec >= 0.2 & RT_sec <= 1.5,
    ACC == 1 | ACC == 0
  ) %>%
  dplyr::arrange(
    Subject, Matching, Identity
  )

names(df)[5] <- "Paper 51 Exp 2"
summary(df[[5]])
write.csv(x = df[[5]], file = "../../4_Data_Extraction/4_2_Open_Data/Paper_51/Clean_Data/P51_Exp2_Clean.csv")
```

# Paper 54 
## Experiment 1 (Identtiy = 4)
"Self", "Mother","none", "Acquaintance"
```{r Paper 54 Experiment 1}
df[[6]] <- read.csv(
  "../../4_Data_Extraction/4_2_Open_Data/Paper_54/Raw_Data/P54_Exp1_raw.csv"
  ) %>%
  dplyr::filter(
    Procedure.Trial. == "FLproc"
  ) %>%
  dplyr::mutate(
    Subject = as.numeric(Subject),
    Matching = case_when(
      FLbed == "comp" ~ "Matching",
      FLbed == "incomp" ~ "Nonmatching"
    ),
    Identity = case_when(
      flanker == "Ich" ~ "Self",
      flanker == "Mutter" ~ "Mother",
      flanker == "none" ~ "none",
      flanker == "Bekannter" ~ "Acquaintance"
    ),
    RT_ms = fl.RT,
    RT_sec = fl.RT / 1000,
    ACC = as.numeric(fl.ACC)
  ) %>%
  dplyr::mutate(
    Subjcet = as.numeric(Subject),
    Matching = factor(
      Matching, levels = c("Matching", "Nonmatching")
    ),
    Identity = factor(
      Identity, levels = c("Self", "Mother", "none", "Acquaintance")
    ),
    RT_ms = as.numeric(RT_ms),
    RT_sec = as.numeric(RT_sec),
    ACC = as.numeric(ACC),
  ) %>%
  dplyr::select(
    Subject, Matching, Identity, RT_ms, RT_sec, ACC
  ) %>%
  dplyr::mutate(
    RT_sec = round(RT_sec, 3),
    RT_ms = round(RT_ms, 0)
  ) %>%
  dplyr::filter(
    RT_sec >= 0.2 & RT_sec <= 1.5,
    ACC == 1 | ACC == 0
  ) %>%
  dplyr::arrange(
    Subject, Matching, Identity
  )

names(df)[6] <- "Paper 54 Exp 1"
summary(df[[6]])
write.csv(x = df[[6]], file = "../../4_Data_Extraction/4_2_Open_Data/Paper_54/Clean_Data/P54_Exp1_Clean.csv")
```

## Experiment 3 (Identtiy = 3)
"Self", "Mother", "Acquaintance"
```{r Paper 54 Experiment 3}
df[[7]] <- read.csv(
  "../../4_Data_Extraction/4_2_Open_Data/Paper_54/Raw_Data/P54_Exp3_raw.csv"
  ) %>%
  dplyr::filter(
    Procedure == "RPproc"
  ) %>%
  dplyr::mutate(
    Subject = as.numeric(Subject),
    Matching = case_when(
      Match == "comp" ~ "Matching",
      Match == "incomp" ~ "Nonmatching"
    ),
    Identity = case_when(
      Identity == "Ich" ~ "Self",
      Identity == "Mutter" ~ "Mother",
      Identity == "Bekannter" ~ "Acquaintance"
    ),
    RT_ms = RT,
    RT_sec = RT / 1000,
    ACC = as.numeric(ACC)
  ) %>%
  dplyr::mutate(
    Subjcet = as.numeric(Subject),
    Matching = factor(
      Matching, levels = c("Matching", "Nonmatching")
    ),
    Identity = factor(
      Identity, levels = c("Self", "Mother", "Acquaintance")
    ),
    RT_ms = as.numeric(RT_ms),
    RT_sec = as.numeric(RT_sec),
    ACC = as.numeric(ACC),
  ) %>%
  dplyr::select(
    Subject, Matching, Identity, RT_ms, RT_sec, ACC
  ) %>%
  dplyr::mutate(
    RT_sec = round(RT_sec, 3),
    RT_ms = round(RT_ms, 0)
  ) %>%
  dplyr::filter(
    RT_sec >= 0.2 & RT_sec <= 1.5,
    ACC == 1 | ACC == 0
  ) %>%
  dplyr::arrange(
    Subject, Matching, Identity,
  )

names(df)[7] <- "Paper 54 Exp 3"
summary(df[[7]])
write.csv(x = df[[7]], file = "../../4_Data_Extraction/4_2_Open_Data/Paper_54/Clean_Data/P54_Exp3_Clean.csv")
```

# Paper 95 (Face)
## Experiment 1 (Identtiy = 3)
"Self", "Friend", "Stranger"
```{r Paper 95 Experiment 1}
df[[8]] <- read.csv(
  "../../4_Data_Extraction/4_2_Open_Data/Paper_95/Raw_Data/P95_Exp1_raw.csv"
  ) %>%
  dplyr::filter(
    PracticeMode == "No"
  ) %>%
  dplyr::select(
    Subject,
    Label = Cue,
    Shape = Stimulus,
    Face_Gender = Face_Gender,
    RT_ms = Cue.RT,
    ACC = Cue.ACC
  ) %>%
  dplyr::mutate(
    Shape = case_when(
      Shape == "shape1.jpg" ~ "Self",
      Shape == "shape2.jpg" ~ "Friend",
      Shape == "shape3.jpg" ~ "Stranger",
      is.na(Shape) ~ NA_character_,
      TRUE ~ Shape
    ),
    Label = case_when(
      Label == "You" ~ "Self",
      Label == "Friend" ~ "Friend",
      Label == "Stranger" ~ "Stranger",
      is.na(Label) ~ NA_character_,
      TRUE ~ Label
    ),
    Matching = case_when(
      Shape == Label ~ "Matching",
      Shape != Label ~ "Nonmatching"
    ),
    Identity = Shape,
    Face_Gender = case_when(
      Face_Gender == "F" ~ 1,
      Face_Gender == "M" ~ 2
    ),
    RT_ms = as.numeric(RT_ms),
    RT_sec = RT_ms / 1000
  ) %>%
  dplyr::mutate(
    Subjcet = as.numeric(Subject),
    Matching = factor(
      Matching, levels = c("Matching", "Nonmatching")
    ),
    Identity = factor(
      Identity, levels = c("Self", "Friend", "Stranger")
    ),
    Face_Gender = as.factor(Face_Gender),
    RT_ms = as.numeric(RT_ms),
    RT_sec = as.numeric(RT_sec),
    ACC = as.numeric(ACC),
  ) %>%
  dplyr::select(
    Subject, Matching, Identity, RT_ms, RT_sec, ACC, Face_Gender
  ) %>%
  dplyr::mutate(
    RT_sec = round(RT_sec, 3),
    RT_ms = round(RT_ms, 0)
  ) %>%
  dplyr::filter(
    RT_sec >= 0.2 & RT_sec <= 1.5,
    ACC == 1 | ACC == 0
  ) %>%
  dplyr::arrange(
    Subject, Matching, Identity
  )

names(df)[8] <- "Paper 95 Exp 1"
summary(df[[8]])
write.csv(x = df[[8]], file = "../../4_Data_Extraction/4_2_Open_Data/Paper_95/Clean_Data/P95_Exp1_Clean.csv")
```

## Experiment 2 (Identtiy = 3)
"Self", "Friend", "Stranger"
```{r Paper 95 Experiment 2}
df[[9]] <- read.csv(
  "../../4_Data_Extraction/4_2_Open_Data/Paper_95/Raw_Data/P95_Exp2_raw.csv"
  ) %>%
  dplyr::filter(
    PracticeMode == "No"
  ) %>%
  dplyr::select(
    Subject,
    Label = Cue,
    Shape = Stimulus,
    Face_Gender = Face_Gender,
    RT_ms = Stimulus.RT,
    ACC = Stimulus.ACC
  ) %>%
  dplyr::mutate(
    Shape = case_when(
      Shape == "shape1.jpg" ~ "Self",
      Shape == "shape2.jpg" ~ "Friend",
      Shape == "shape3.jpg" ~ "Stranger",
      is.na(Shape) ~ NA_character_,
      TRUE ~ Shape
    ),
    Label = case_when(
      Label == "You" ~ "Self",
      Label == "Friend" ~ "Friend",
      Label == "Stranger" ~ "Stranger",
      is.na(Label) ~ NA_character_,
      TRUE ~ Label
    ),
    Matching = case_when(
      Shape == Label ~ "Matching",
      Shape != Label ~ "Nonmatching"
    ),
    Identity = Shape,
    Face_Gender = case_when(
      Face_Gender == "F" ~ 1,
      Face_Gender == "M" ~ 2
    ),
    RT_ms = as.numeric(RT_ms),
    RT_sec = RT_ms / 1000
  ) %>%
  dplyr::mutate(
    Subjcet = as.numeric(Subject),
    Matching = factor(
      Matching, levels = c("Matching", "Nonmatching")
    ),
    Identity = factor(
      Identity, levels = c("Self", "Friend", "Stranger")
    ),
    Face_Gender = as.factor(Face_Gender),
    RT_ms = as.numeric(RT_ms),
    RT_sec = as.numeric(RT_sec),
    ACC = as.numeric(ACC),
  ) %>%
  dplyr::select(
    Subject, Matching, Identity, RT_ms, RT_sec, ACC, Face_Gender
  ) %>%
  dplyr::mutate(
    RT_sec = round(RT_sec, 3),
    RT_ms = round(RT_ms, 0)
  ) %>%
  dplyr::filter(
    RT_sec >= 0.2 & RT_sec <= 1.5,
    ACC == 1 | ACC == 0
  ) %>%
  dplyr::arrange(
    Subject, Matching, Identity
  )

names(df)[9] <- "Paper 95 Exp 2"
summary(df[[9]])
write.csv(x = df[[9]], file = "../../4_Data_Extraction/4_2_Open_Data/Paper_95/Clean_Data/P95_Exp2_Clean.csv")
```

# Paper n4
## Experiment 1 (Identtiy = 3)
"Self", "Friend", "Stranger"
```{r Paper n4 Experiment 1}
df[[10]] <- read.csv(
  "../../4_Data_Extraction/4_2_Open_Data/Paper_n4/Raw_Data/Pn4_Exp1_raw.csv"
  ) %>%
  dplyr::mutate(
    Subject = as.numeric(subject),
    Matching = case_when(
      type == "match" ~ "Matching",
      type == "nonmatch" ~ "Nonmatching"
    ),
    blocktype = case_when(
      blocktype == "mixed" ~ 1,
      blocktype == "blocked" ~ 2
    ),
    Identity = as.character(shape),
    RT_ms = as.numeric(latency),
    RT_sec = RT_ms / 1000,
    ACC = as.numeric(correct)
  ) %>%
  dplyr::mutate(
    Subjcet = as.numeric(Subject),
    Matching = factor(
      Matching, levels = c("Matching", "Nonmatching")
    ),
    Identity = factor(
      Identity, levels = c("Self", "Friend", "Stranger")
    ),
    RT_ms = as.numeric(RT_ms),
    RT_sec = as.numeric(RT_sec),
    ACC = as.numeric(ACC),
  ) %>%
  dplyr::select(
    Subject, Matching, Identity, RT_ms, RT_sec, ACC, blocktype
  ) %>%
  dplyr::mutate(
    RT_sec = round(RT_sec, 3),
    RT_ms = round(RT_ms, 0)
  ) %>%
  dplyr::filter(
    RT_sec >= 0.2 & RT_sec <= 1.5,
    ACC == 1 | ACC == 0
  ) %>%
  dplyr::arrange(
    Subject, Matching, Identity
  )

names(df)[10] <- "Papaer n4 Exp 1"
summary(df[[10]])
write.csv(x = df[[10]], file = "../../4_Data_Extraction/4_2_Open_Data/Paper_n4/Clean_Data/Pn4_Exp1_Clean.csv")
```

## Experiment 2 (Identtiy = 3)
"Self", "Friend", "Stranger"
```{r Paper n4 Experiment 1}
df[[11]] <- read.csv(
  "../../4_Data_Extraction/4_2_Open_Data/Paper_n4/Raw_Data/Pn4_Exp1_raw.csv"
  ) %>%
  dplyr::mutate(
    Subject = as.numeric(subject),
    Matching = case_when(
      type == "match" ~ "Matching",
      type == "nonmatch" ~ "Nonmatching"
    ),
    blocktype = case_when(
      blocktype == "mixed" ~ 1,
      blocktype == "blocked" ~ 2
    ),
    Identity = as.character(shape),
    RT_ms = as.numeric(latency),
    RT_sec = RT_ms / 1000,
    ACC = as.numeric(correct)
  ) %>%
  dplyr::mutate(
    Subjcet = as.numeric(Subject),
    Matching = factor(
      Matching, levels = c("Matching", "Nonmatching")
    ),
    Identity = factor(
      Identity, levels = c("Self", "Friend", "Stranger")
    ),
    RT_ms = as.numeric(RT_ms),
    RT_sec = as.numeric(RT_sec),
    ACC = as.numeric(ACC),
  ) %>%
  dplyr::select(
    Subject, Matching, Identity, RT_ms, RT_sec, ACC, blocktype
  ) %>%
  dplyr::mutate(
    RT_sec = round(RT_sec, 3),
    RT_ms = round(RT_ms, 0)
  ) %>%
  dplyr::filter(
    RT_sec >= 0.2 & RT_sec <= 1.5,
    ACC == 1 | ACC == 0
  ) %>%
  dplyr::arrange(
    Subject, Matching, Identity
  )

names(df)[11] <- "Papaer n4 Exp 2"
summary(df[[11]])
write.csv(x = df[[11]], file = "../../4_Data_Extraction/4_2_Open_Data/Paper_n4/Clean_Data/Pn4_Exp2_Clean.csv")
```

# Paper n13
## Experiment 1 (Identtiy = 3)
"Self", "Friend", "Stranger"
```{r Paper n13 Experiment 1}
df[[12]] <- read.csv(
  "../../4_Data_Extraction/4_2_Open_Data/Paper_n13/Raw_Data/Pn13_Exp1_raw.csv"
  ) %>%
  dplyr::select(
    Subject,
    Shape = Stimulus,
    Label = Word,
    CloseShape,
    MediumShape,
    FarShape,
    RT = Target.RT,
    ACC = Target.ACC
  ) %>%
  dplyr::mutate(
    # 需要先生成Identity(Shape)，然后在判断是否Shape == Label
    Identity = case_when(
      Shape == CloseShape ~ "Self",
      Shape == MediumShape ~ "Friend",
      Shape == FarShape ~ "Stranger",
      TRUE ~ Shape # 存在NA
    ),
    Matching = case_when(
      Identity == Label ~ "Matching",
      Identity != Label ~ "Nonmatching",
    ),
    RT_ms = as.numeric(RT),
    RT_sec = RT_ms / 1000,
    ACC = as.numeric(ACC),
  ) %>%
  dplyr::mutate(
    Subjcet = as.numeric(Subject),
    Matching = factor(
      Matching, levels = c("Matching", "Nonmatching")
    ),
    Identity = factor(
      Identity, levels = c("Self", "Friend", "Stranger")
    ),
    RT_ms = as.numeric(RT_ms),
    RT_sec = as.numeric(RT_sec),
    ACC = as.numeric(ACC),
  ) %>%
  dplyr::select(
    Subject, Matching, Identity, RT_ms, RT_sec, ACC
  ) %>%
  dplyr::mutate(
    RT_sec = round(RT_sec, 3),
    RT_ms = round(RT_ms, 0)) %>%
  dplyr::filter(
    RT_sec >= 0.2 & RT_sec <= 1.5,
    ACC == 1 | ACC == 0
  ) %>%
  dplyr::arrange(
    Subject, Matching, Identity
  )

names(df)[12] <- "Papaer n13 Exp 1"
summary(df[[12]])
write.csv(x = df[[12]], file = "../../4_Data_Extraction/4_2_Open_Data/Paper_n13/Clean_Data/Pn13_Exp1_Clean.csv")
```

## Experiment 2 (Identtiy = 3)
"Father", "Close", "Stranger"
```{r Paper n13 Experiment 1}
# df[[14]] <- read.csv(
#   "../../4_Data_Extraction/4_2_Open_Data/Paper_n13/Raw_Data/Pn13_Exp2_raw.csv"
#   ) %>%
#   dplyr::select(
#     Subject,
#     Shape = Stimulus,
#     Label = Word,
#     CloseShape,
#     MediumShape,
#     FarShape,
#     RT = Target.RT,
#     ACC = Target.ACC
#   ) %>%
#   dplyr::mutate(
#     # 需要先生成Identity(Shape)，然后在判断是否Shape == Label
#     Identity = case_when(
#       Shape == CloseShape ~ "Self",
#       Shape == MediumShape ~ "Friend",
#       Shape == FarShape ~ "Stranger",
#       TRUE ~ Shape # 存在NA
#     ),
#     Matching = case_when(
#       Identity == Label ~ "Matching",
#       Identity != Label ~ "Nonmatching",
#     ),
#     RT_ms = as.numeric(RT),
#     RT_sec = RT_ms / 1000,
#     ACC = as.numeric(ACC),
#   ) %>%
#   dplyr::mutate(
#     Subjcet = as.numeric(Subject),
#     Matching = factor(
#       Matching, levels = c("Matching", "Nonmatching")
#     ),
#     Identity = factor(
#       Identity, levels = c("Self", "Friend", "Stranger")
#     ),
#     RT_ms = as.numeric(RT_ms),
#     RT_sec = as.numeric(RT_sec),
#     ACC = as.numeric(ACC),
#   ) %>%
#   dplyr::select(
#     Subject, Matching, Identity, RT_ms, RT_sec, ACC
#   ) %>%
#   dplyr::mutate(
#     RT_sec = round(RT_sec, 3),
#     RT_ms = round(RT_ms, 0)) %>%
#   dplyr::filter(
#     RT_sec >= 0.2 & RT_sec <= 1.5,
#     ACC == 1 | ACC == 0
#   ) %>%
#   dplyr::arrange(
#     Subject, Matching, Identity
#   )
# 
# names(df)[14] <- "Papaer n13 Exp 2"
# summary(df[[14]])
# write.csv(x = df[[14]], file = "../../4_Data_Extraction/4_2_Open_Data/Paper_n13/Clean_Data/Pn13_Exp2_Clean.csv")
```

## Experiment 3 (Identtiy = 3)
"Self", "Father", "Stranger"
```{r Paper n13 Experiment 3}
df[[13]] <- read.csv(
  "../../4_Data_Extraction/4_2_Open_Data/Paper_n13/Raw_Data/Pn13_Exp3_raw.csv"
  ) %>%
  dplyr::select(
    Subject,
    Shape = Stimulus,
    Label = Word,
    CloseShape,
    MediumShape,
    FarShape,
    RT = Target.RT,
    ACC = Target.ACC) %>%
  dplyr::mutate(
    Identity = case_when(
      Shape == CloseShape ~ "Self",
      Shape == MediumShape ~ "Father",
      Shape == FarShape ~ "Stranger",
      TRUE ~ Shape),
    Matching = case_when(
      Identity == Label ~ "Matching",
      Identity != Label ~ "Nonmatching",
    ),
    RT_ms = as.numeric(RT),
    RT_sec = RT_ms / 1000,
    ACC = as.numeric(ACC),
  ) %>%
  dplyr::mutate(
    Subjcet = as.numeric(Subject),
    Matching = factor(
      Matching, levels = c("Matching", "Nonmatching")
    ),
    Identity = factor(
      Identity, levels = c("Self", "Father", "Stranger")
    ),
    RT_ms = as.numeric(RT_ms),
    RT_sec = as.numeric(RT_sec),
    ACC = as.numeric(ACC),
  ) %>%
  dplyr::select(
    Subject, Matching, Identity, RT_ms, RT_sec, ACC
  ) %>%
  dplyr::mutate(
    RT_sec = round(RT_sec, 3),
    RT_ms = round(RT_ms, 0)
  ) %>%
  dplyr::filter(
    RT_sec >= 0.2 & RT_sec <= 1.5,
    ACC == 1 | ACC == 0
  ) %>%
  dplyr::arrange(
    Subject, Matching, Identity
  )

names(df)[13] <- "Papaer n13 Exp 3"
summary(df[[13]])
write.csv(x = df[[13]], file = "../../4_Data_Extraction/4_2_Open_Data/Paper_n13/Clean_Data/Pn13_Exp3_Clean.csv")
```

## Experiment 4 (Identtiy = 3)
"Self", "Friend", "Stranger"
```{r Paper n13 Experiment 4}
df[[14]] <- read.csv(
  "../../4_Data_Extraction/4_2_Open_Data/Paper_n13/Raw_Data/Pn13_Exp4_raw.csv"
  ) %>%
  dplyr::select(
    Subject,
    Shape = Stimulus,
    Label = Word,
    CloseShape,
    MediumShape,
    FarShape,
    RT = Target.RT,
    ACC = Target.ACC
    ) %>%
  dplyr::mutate(
    Identity = case_when(
      Shape == CloseShape ~ "Self",
      Shape == MediumShape ~ "Friend",
      Shape == FarShape ~ "Stranger",
      TRUE ~ Shape
      ),
    Matching = case_when(
      Identity == Label ~ "Matching",
      Identity != Label ~ "Nonmatching",
    ),
    RT_ms = as.numeric(RT),
    RT_sec = RT_ms / 1000,
    ACC = as.numeric(ACC),
    ) %>%
  dplyr::mutate(
    Subjcet = as.numeric(Subject),
    Matching = factor(
      Matching, levels = c("Matching", "Nonmatching")
      ),
    Identity = factor(
      Identity, levels = c("Self", "Friend", "Stranger")
      ),
    RT_ms = as.numeric(RT_ms),
    RT_sec = as.numeric(RT_sec),
    ACC = as.numeric(ACC),
    ) %>%
  dplyr::select(
    Subject, Matching, Identity, RT_ms, RT_sec, ACC
    ) %>%
  dplyr::mutate(
    RT_sec = round(RT_sec, 3),
    RT_ms = round(RT_ms, 0)) %>%
  dplyr::filter(
    RT_sec >= 0.2 & RT_sec <= 1.5,
    ACC == 1 | ACC == 0
    ) %>%
  dplyr::arrange(
    Subject, Matching, Identity
    )

names(df)[14] <- "Papaer n13 Exp 4"
summary(df[[14]])
write.csv(x = df[[14]], file = "../../4_Data_Extraction/4_2_Open_Data/Paper_n13/Clean_Data/Pn13_Exp4_Clean.csv")
```

# Paper n16
## Experiment 1 (Identtiy = 2)
"Self", "Friend"
```{r Paper n16 Experiment 1}
df[[15]] <- read.csv(
  "../../4_Data_Extraction/4_2_Open_Data/Paper_n16/Raw_Data/Pn16_Exp1_raw.csv"
  ) %>%
  dplyr::select(
    Subject = Participant..,
    Matching = Trial.Type,
    Identity = Shape.Association,
    RT_ms = Reponse.Time,
    ACC = Target.Accuracy
    ) %>%
  dplyr::mutate(
    RT_ms = as.numeric(RT_ms),
    RT_sec = RT_ms / 1000
    ) %>%
  dplyr::mutate(
    Subjcet = as.numeric(Subject),
    Matching = factor(
      Matching, levels = c("Matching", "Nonmatching")
      ),
    Identity = factor(
      Identity, levels = c("Self", "Friend")
      ),
    RT_ms = as.numeric(RT_ms),
    RT_sec = as.numeric(RT_sec),
    ACC = as.numeric(ACC),
    ) %>%
  dplyr::select(
    Subject, Matching, Identity, RT_ms, RT_sec, ACC
    ) %>%
  dplyr::mutate(
    RT_sec = round(RT_sec, 3),
    RT_ms = round(RT_ms, 0)
    ) %>%
  dplyr::filter(
    RT_sec >= 0.2 & RT_sec <= 1.5,
    ACC == 1 | ACC == 0
    ) %>%
  dplyr::arrange(
    Subject, Matching, Identity
    )

names(df)[15] <- "Papaer n16 Exp 1"
summary(df[[15]])
write.csv(x = df[[15]], file = "../../4_Data_Extraction/4_2_Open_Data/Paper_n16/Clean_Data/Pn16_Exp1_Clean.csv")
```

## Experiment 2 (Identtiy = 2)
"Self", "Friend"
```{r Paper n16 Experiment 2}
df[[16]] <- read.csv(
  "../../4_Data_Extraction/4_2_Open_Data/Paper_n16/Raw_Data/Pn16_Exp2_raw.csv"
  ) %>%
  dplyr::select(
    Subject = Participant,
    Matching = Trial.Type,
    Identity = Shape.Association,
    RT_ms = Response.Time,
    ACC = Target.Accuracy
    ) %>%
  dplyr::mutate(
    RT_ms = as.numeric(RT_ms),
    RT_sec = RT_ms / 1000
    ) %>%
  dplyr::mutate(
    Subjcet = as.numeric(Subject),
    Matching = factor(
      Matching, levels = c("Matching", "Nonmatching")
      ),
    Identity = factor(
      Identity, levels = c("Self", "Friend")
      ),
    RT_ms = as.numeric(RT_ms),
    RT_sec = as.numeric(RT_sec),
    ACC = as.numeric(ACC),
    ) %>%
  dplyr::select(
    Subject, Matching, Identity, RT_ms, RT_sec, ACC
    ) %>%
  dplyr::mutate(
    RT_sec = round(RT_sec, 3),
    RT_ms = round(RT_ms, 0)) %>%
  dplyr::filter(
    RT_sec >= 0.2 & RT_sec <= 1.5,
    ACC == 1 | ACC == 0
    ) %>%
  dplyr::arrange(
    Subject, Matching, Identity
    )

names(df)[16] <- "Papaer n16 Exp 2"
summary(df[[16]])
write.csv(x = df[[16]], file = "../../4_Data_Extraction/4_2_Open_Data/Paper_n16/Clean_Data/Pn16_Exp2_Clean.csv")
```

## Experiment 3 (Identtiy = 2)
"Self", "Friend"
```{r Paper n16 Experiment 3}
df[[17]] <- read.csv(
  "../../4_Data_Extraction/4_2_Open_Data/Paper_n16/Raw_Data/Pn16_Exp3_raw.csv"
  ) %>%
  dplyr::select(
    Subject = Participant,
    Matching = Trial.Type,
    Identity = Shape.Association,
    RT_ms = Response.Time,
    ACC = Target.Accuracy
    ) %>%
  dplyr::mutate(
    RT_ms = as.numeric(RT_ms),
    RT_sec = RT_ms / 1000
    ) %>%
  dplyr::mutate(
    Subjcet = as.numeric(Subject),
    Matching = factor(
      Matching, levels = c("Matching", "Nonmatching")
      ),
    Identity = factor(
      Identity, levels = c("Self", "Friend")
      ),
    RT_ms = as.numeric(RT_ms),
    RT_sec = as.numeric(RT_sec),
    ACC = as.numeric(ACC),
    ) %>%
  dplyr::select(
    Subject, Matching, Identity, RT_ms, RT_sec, ACC
    ) %>%
  dplyr::mutate(
    RT_sec = round(RT_sec, 3),
    RT_ms = round(RT_ms, 0)
    ) %>%
  dplyr::filter(
    RT_sec >= 0.2 & RT_sec <= 1.5,
    ACC == 1 | ACC == 0
    ) %>%
  dplyr::arrange(
    Subject, Matching, Identity
    )

names(df)[17] <- "Papaer n16 Exp 3"
summary(df[[17]])
write.csv(x = df[[17]], file = "../../4_Data_Extraction/4_2_Open_Data/Paper_n16/Clean_Data/Pn16_Exp3_Clean.csv")
```

# Paper n23
## Experiment 1 (Identtiy = 3)
"Self", "Friend", "Stranger"
```{r Paper n23 Experiment 1}
df[[18]] <- read.csv(
  "../../4_Data_Extraction/4_2_Open_Data/Paper_n23/Raw_Data/Pn23_Exp1_raw.csv"
  ) %>%
  dplyr::select(
    Subject = Subject,
    Matching = Correctanswer,
    Identity = Shape,
    Group = Group,
    RT_ms = iti.RT,
    ACC = iti.ACC,
    ) %>%
  dplyr::mutate(
    Matching = case_when(
      Matching == "j" ~ "Matching",
      Matching == "f" ~ "Nonmatching"),
    RT_ms = as.numeric(RT_ms),
    RT_sec = RT_ms / 1000,
    ) %>%
  dplyr::mutate(
    Subjcet = as.numeric(Subject),
    Matching = factor(
      Matching, levels = c("Matching", "Nonmatching")
      ),
    Identity = factor(
      Identity, levels = c("Self", "Friend", "Stranger")
      ),
    Group = as.factor(Group),
    RT_ms = as.numeric(RT_ms),
    RT_sec = as.numeric(RT_sec),
    ACC = as.numeric(ACC),
    ) %>%
  dplyr::select(
    Subject, Matching, Identity, Group, RT_ms, RT_sec, ACC
    ) %>%
  dplyr::mutate(
    RT_sec = round(RT_sec, 3),
    RT_ms = round(RT_ms, 0)
    ) %>%
  dplyr::filter(
    RT_sec >= 0.2 & RT_sec <= 1.5,
    ACC == 1 | ACC == 0
    ) %>%
  dplyr::arrange(
    Subject, Matching, Identity, Group
    )

names(df)[18] <- "Papaer n23 Exp 1"
summary(df[[18]])
write.csv(x = df[[18]], file = "../../4_Data_Extraction/4_2_Open_Data/Paper_n23/Clean_Data/Pn23_Exp1_Clean.csv")
```

# Paper s1 (Face)
## Experiment 1 (Identtiy = 2)
"Self", "Stranger"
```{r Paper s1 Experiment 1}
df_Ps1_E1 <- read.csv(
  "../../4_Data_Extraction/4_2_Open_Data/Paper_s1/Raw_Data/Ps1_Exp1_raw.csv"
  ) %>%
  dplyr::select(
    Subject = Participant.Public.ID,
    Match = P_Orginal,
    Identity = P_Group,
    RT_ms = Reaction.Time,
    ACC = Correct
  ) %>%
  dplyr::mutate(
    Matching = case_when(
      Match == "JA" ~ "Matching",
      Match == "NEIN" ~ "Nonmatching"
    ),
    Identity = case_when(
      Identity == "User" ~ "Self",
      Identity == "Other" ~ "Stranger"
    ),
    RT_ms = as.numeric(RT_ms),
    RT_sec = RT_ms / 1000,
    ACC = as.numeric(ACC)
    )

df_Subject_ID <- df_Ps1_E1 %>% # nolint
  dplyr::group_by(
    Subject
  ) %>%
  dplyr::summarise(
    count = n()
  ) %>%
  dplyr::mutate(
    Subject_ID = row_number()
  ) %>%
  dplyr::select(
    Subject, Subject_ID
  )

df[[19]] <- df_Ps1_E1 %>%
  dplyr::left_join(
    df_Subject_ID,
    by = "Subject"
  ) %>%
  dplyr::mutate(
    Subject = Subject_ID
  ) %>%
  dplyr::mutate(
    Subjcet = as.numeric(Subject),
    Matching = factor(
      Matching, levels = c("Matching", "Nonmatching")
    ),
    Identity = factor(
      Identity, levels = c("Self", "Stranger")
    ),
    RT_ms = as.numeric(RT_ms),
    RT_sec = as.numeric(RT_sec),
    ACC = as.numeric(ACC),
  ) %>%
  dplyr::select(
    Subject, Matching, Identity, RT_ms, RT_sec, ACC
  ) %>%
  dplyr::mutate(
    RT_sec = round(RT_sec, 3),
    RT_ms = round(RT_ms, 0)
  ) %>%
  dplyr::filter(
    RT_sec >= 0.2 & RT_sec <= 1.5,
    ACC == 1 | ACC == 0
  ) %>%
  dplyr::arrange(
    Subject, Matching, Identity
  )

rm(df_Subject_ID, df_Ps1_E1)

names(df)[19] <- "Paper s1 Exp 1"
summary(df[[19]])
write.csv(x = df[[19]], file = "../../4_Data_Extraction/4_2_Open_Data/Paper_s1/Clean_Data/Ps1_Exp1_Clean.csv")
```

```{r}
df[[19]] <- read.csv("../../4_Data_Extraction/4_2_Open_Data/Paper_s1/Clean_Data/Ps1_Exp1_Clean.csv") %>%
  dplyr::filter(
    !(Subject %in% c(51, 143, 153, 158, 212, 255, 257))
  )
write.csv(x = df[[19]], file = "../../4_Data_Extraction/4_2_Open_Data/Paper_s1/Clean_Data/Ps1_Exp1_Clean.csv")
```

# Paper s2
## Experiment 1 (Identtiy = 2)
"Self", "Stranger"
```{r Paper s2 Experiment 1}
df[[20]] <- read.csv(
  "../../4_Data_Extraction/4_2_Open_Data/Not_Good/Paper_s2/Ps2_Exp1_raw.csv"
  ) %>%
  dplyr::filter(
    Session != 3,
    !(Subject %in% c(6205, 6209, 6223)),
  ) %>%
  dplyr::select(
    Subject = Subject,
    Matching = CorrectAnswer,
    Identity = identity,
    RT = Target.RT,
    ACC = Target.ACC
  ) %>%
  dplyr::mutate(
    Matching = case_when(
      Matching == "m" ~ "Matching",
      Matching == "k" ~ "Nonmatching"
    ),
    Identity = case_when(
      Identity == "self" ~ "Self",
      Identity == "other" ~ "Stranger"
    ),
    RT_ms = as.numeric(RT),
    RT_sec = RT_ms / 1000,
  ) %>%
  dplyr::mutate(
    Subjcet = as.numeric(Subject),
    Matching = factor(
      Matching, levels = c("Matching", "Nonmatching")
    ),
    Identity = factor(
      Identity, levels = c("Self", "Stranger")
    ),
    RT_ms = as.numeric(RT_ms),
    RT_sec = as.numeric(RT_sec),
    ACC = as.numeric(ACC),
  ) %>%
  dplyr::select(
    Subject, Matching, Identity,RT_ms, RT_sec, ACC
  ) %>%
  dplyr::mutate(
    RT_sec = round(RT_sec, 3),
    RT_ms = round(RT_ms, 0)
  ) %>%
  dplyr::filter(
    RT_sec >= 0.2 & RT_sec <= 1.5,
    ACC == 1 | ACC == 0
  ) %>%
  dplyr::arrange(
    Subject, Matching, Identity
  )

names(df)[20] <- "Paper s2 Exp 1"
summary(df[[20]])
write.csv(x = df[[20]], file = "../../4_Data_Extraction/4_2_Open_Data/Not_Good/Paper_s2/Ps2_Exp1_Clean.csv")
```

# Paper s3
## Experiment 1 (Identtiy = 3)
"Self", "Friend", "Stranger"
```{r Paper s3 Experiment 1}
df[[22]] <- read.csv(
  "../../4_Data_Extraction/4_2_Open_Data/Paper_s3/Ps3_Exp1_raw.csv"
  ) %>%
  dplyr::select(
    Subject = Subject,
    Session = Session,
    Group = Block,
    Shape = SelfRelated,
    Label = Question, 
    RT_ms = RT,
    ACC = ACC,
  ) %>%
  dplyr::mutate(
    Label = case_when(
      Label == "You" ~ "Self",
      TRUE ~ Label),
    Matching = case_when(
      Shape == Label ~ "Matching",
      Shape != Label ~ "Nonmatching"),
    RT_sec = RT_ms / 1000,
    Identity = Shape
  ) %>%
  dplyr::mutate(
    Subjcet = as.numeric(Subject),
    Matching = factor(
      Matching, levels = c("Matching", "Nonmatching")
    ),
    Identity = factor(
      Identity, levels = c("Self", "Friend","Stranger")
    ),
    Session = as.factor(Session),
    RT_ms = as.numeric(RT_ms),
    RT_sec = as.numeric(RT_sec),
    ACC = as.numeric(ACC),
  ) %>%
  dplyr::select(
    Subject, Matching, Identity, Session, RT_ms, RT_sec, ACC
  ) %>%
  dplyr::mutate(
    RT_sec = round(RT_sec, 3),
    RT_ms = round(RT_ms, 0)
  ) %>%
  dplyr::filter(
    RT_sec >= 0.2 & RT_sec <= 1.5,
    ACC == 1 | ACC == 0
  ) %>%
  dplyr::arrange(
    Subject, Matching, Identity, Session
  )

names(df)[22] <- "Paper s3 Exp 1"
summary(df[[22]])
write.csv(x = df[[22]], file = "../../4_Data_Extraction/4_2_Open_Data/Paper_s3/Ps3_Exp1_Clean.csv")
```

# Paper s4
## Experiment 1 (Identtiy = 3)
"Self", "Friend", "Stranger"
```{r Paper s4 Experiment 1}
# 获取文件夹内所有满足条件的文件名
file_list <- list.files(
  path = "../../4_Data_Extraction/4_2_Open_Data/Paper_s4/Source/",
  pattern = "^PractExperiment_1.*\\.mat$",
  full.names = TRUE
)

# 创建一个空的列表来存储读取的.mat文件
list_mat_e1 <- list()

# 循环读取文件并存储到列表中
for (file in file_list) {
  mat_data <- R.matlab::readMat(file)
  list_mat_e1[[basename(file)]] <- mat_data
}

rm(file, file_list)

df[[23]] <- read.mat(
  list = list_mat_e1
  ) %>%
  dplyr::mutate(
    Matching = case_when(
      Shape == Label ~ "Matching",
      Shape != Label ~ "Nonmatching"),
    Identity = case_when(
      Shape == 1 ~ "Self",
      Shape == 2 ~ "Friend",
      Shape == 3 ~ "Stranger"
    ),
    RT_ms = RT,
    RT_sec = RT / 1000,
    ) %>%
  dplyr::mutate(
    Subjcet = as.numeric(Subject),
    Matching = factor(
      Matching, levels = c("Matching", "Nonmatching")
    ),
    Identity = factor(
      Identity, levels = c("Self", "Friend","Stranger")
    ),
    Session = as.factor(Session),
    RT_ms = as.numeric(RT_ms),
    RT_sec = as.numeric(RT_sec),
    ACC = as.numeric(ACC),
  ) %>%
  dplyr::select(
    Subject, Matching, Identity, Session, RT_ms, RT_sec, ACC
  ) %>%
  dplyr::mutate(
    RT_sec = round(RT_sec, 3),
    RT_ms = round(RT_ms, 0)
  ) %>%
  dplyr::filter(
    RT_sec >= 0.2 & RT_sec <= 1.5,
    ACC == 1 | ACC == 0
  ) %>%
  dplyr::arrange(
    Subject, Matching, Identity, Session
  )

rm(list_mat_e1)

names(df)[23] <- "Paper s4 Exp 1"
summary(df[[23]])
write.csv(x = df[[23]], file = "../../4_Data_Extraction/4_2_Open_Data/Paper_s4/Ps4_Exp1_Clean.csv")
```

# Paper s4
## Experiment 2 (Identtiy = 3)
"Self", "Friend", "Stranger"
```{r Paper s4 Experiment 2}
# 获取文件夹内所有满足条件的文件名
file_list <- list.files(
  path = "../../4_Data_Extraction/4_2_Open_Data/Paper_s4/Source/",
  pattern = "^PractExperiment_2.*\\.mat$",
  full.names = TRUE
)

# 创建一个空的列表来存储读取的.mat文件
list_mat_e2 <- list()

# 循环读取文件并存储到列表中
for (file in file_list) {
  mat_data <- R.matlab::readMat(file)
  list_mat_e2[[basename(file)]] <- mat_data
}

rm(file, file_list)

df[[24]] <- read.mat(list = list_mat_e2) %>%
  dplyr::mutate(
    Matching = case_when(
      Shape == Label ~ "Matching",
      Shape != Label ~ "Nonmatching"
    ),
    Identity = case_when(
      Shape == 1 ~ "Self",
      Shape == 2 ~ "Friend",
      Shape == 3 ~ "Stranger"
    ),
    RT_ms = RT,
    RT_sec = RT / 1000,
    ) %>%
  dplyr::mutate(
    Subjcet = as.numeric(Subject),
    Matching = factor(
      Matching, levels = c("Matching", "Nonmatching")
    ),
    Identity = factor(
      Identity, levels = c("Self", "Friend","Stranger")
    ),
    Session = as.factor(Session),
    RT_ms = as.numeric(RT_ms),
    RT_sec = as.numeric(RT_sec),
    ACC = as.numeric(ACC),
  ) %>%
  dplyr::select(
    Subject, Matching, Identity, Session, RT_ms, RT_sec, ACC
  ) %>%
  dplyr::mutate(
    RT_sec = round(RT_sec, 3),
    RT_ms = round(RT_ms, 0)
  ) %>%
  dplyr::filter(
    RT_sec >= 0.2 & RT_sec <= 1.5,
    ACC == 1 | ACC == 0
  ) %>%
  dplyr::arrange(
    Subject, Matching, Identity, Session
  )

rm(list_mat_e2)

names(df)[24] <- "Paper s4 Exp 1"
summary(df[[24]])
write.csv(x = df[[24]], file = "../../4_Data_Extraction/4_2_Open_Data/Paper_s4/Ps4_Exp2_Clean.csv")
```

```{r List for Data Frame}
df <- list()
df[[1]] <- read.csv("../../4_Data_Extraction/4_2_Open_Data/Paper_6/Clean_Data/P6_Exp1_Clean.csv")
df[[2]] <- read.csv("../../4_Data_Extraction/4_2_Open_Data/Paper_46/Clean_Data/P46_Exp1_Clean.csv")
df[[3]] <- read.csv("../../4_Data_Extraction/4_2_Open_Data/Paper_46/Clean_Data/P46_Exp2_Clean.csv")
df[[4]] <- read.csv("../../4_Data_Extraction/4_2_Open_Data/Paper_51/Clean_Data/P51_Exp1_Clean.csv")
df[[5]] <- read.csv("../../4_Data_Extraction/4_2_Open_Data/Paper_51/Clean_Data/P51_Exp2_Clean.csv")
df[[6]] <- read.csv("../../4_Data_Extraction/4_2_Open_Data/Paper_54/Clean_Data/P54_Exp1_Clean.csv")
df[[7]] <- read.csv("../../4_Data_Extraction/4_2_Open_Data/Paper_54/Clean_Data/P54_Exp3_Clean.csv")
df[[8]] <- read.csv("../../4_Data_Extraction/4_2_Open_Data/Paper_95/Clean_Data/P95_Exp1_Clean.csv")
df[[9]] <- read.csv("../../4_Data_Extraction/4_2_Open_Data/Paper_95/Clean_Data/P95_Exp2_Clean.csv")
df[[10]] <- read.csv("../../4_Data_Extraction/4_2_Open_Data/Paper_n4/Clean_Data/Pn4_Exp1_Clean.csv")
df[[11]] <- read.csv("../../4_Data_Extraction/4_2_Open_Data/Paper_n4/Clean_Data/Pn4_Exp2_Clean.csv")
df[[12]] <- read.csv("../../4_Data_Extraction/4_2_Open_Data/Paper_n13/Clean_Data/Pn13_Exp1_Clean.csv")
df[[13]] <- read.csv("../../4_Data_Extraction/4_2_Open_Data/Paper_n13/Clean_Data/Pn13_Exp3_Clean.csv")
df[[14]] <- read.csv("../../4_Data_Extraction/4_2_Open_Data/Paper_n13/Clean_Data/Pn13_Exp4_Clean.csv")
df[[15]] <- read.csv("../../4_Data_Extraction/4_2_Open_Data/Paper_n16/Clean_Data/Pn16_Exp1_Clean.csv")
df[[16]] <- read.csv("../../4_Data_Extraction/4_2_Open_Data/Paper_n16/Clean_Data/Pn16_Exp2_Clean.csv")
df[[17]] <- read.csv("../../4_Data_Extraction/4_2_Open_Data/Paper_n16/Clean_Data/Pn16_Exp3_Clean.csv")
df[[18]] <- read.csv("../../4_Data_Extraction/4_2_Open_Data/Paper_n23/Clean_Data/Pn23_Exp1_Clean.csv")
df[[19]] <- read.csv("../../4_Data_Extraction/4_2_Open_Data/Paper_s1/Clean_Data/Ps1_Exp1_Clean.csv")
df[[20]] <- read.csv("../../4_Data_Extraction/4_2_Open_Data/Not_Good/Paper_s2/Ps2_Exp1_Clean.csv")
```

#整合数据
```{r}
combine_data <- function(data_list) {
  # 创建一个空数据框
  combined_df <- data.frame()
  
  # 循环遍历数据列表中的每个数据框
  for (i in seq_along(data_list)) {
    # 提取关键列
    key_columns <- data_list[[i]][c("Subject", "Matching", "Identity", "RT_ms", "RT_sec", "ACC")]
    
    # 添加 Paper 列
    key_columns$Paper <- paste0("df_", i)
    
    # 将数据框添加到组合数据框中
    combined_df <- rbind(combined_df, key_columns)
  }
  
  # 返回组合后的数据框
  return(combined_df)
}

# 使用函数
combined_data <- combine_data(df)

rm(combine_data)
```

# Check ACC
```{r}
calculate_min_ACC <- function(data_list) {
  min_ACC_list <- list()
  
  for (i in seq_along(data_list)) {
    if (!is.null(data_list[[i]])) {
      min_ACC <- data_list[[i]] %>%
        group_by(Subject) %>%
        summarise(mean_ACC = mean(ACC)) %>%
        ungroup() %>%
        filter(mean_ACC < 0.5) %>%
        arrange(mean_ACC)
      
      min_ACC_list[[i]] <- min_ACC
      
      cat(
        "For df[[", i, "]], the min ACC is:",
        ifelse(nrow(min_ACC) > 0, min(min_ACC$mean_ACC), "No data"), # 检查 min_ACC 是否为空
        "\n"
      )
    } else {
      cat("df[[", i, "]] is empty.\n")
    }
  }
  
  rm(min_ACC, i)
  
  return(min_ACC_list)
}

# 使用函数
min_ACC_list <- calculate_min_ACC(df)
rm(calculate_min_ACC)
```

#Clean data by ACC
```{r}
for (i in seq_along(df)) {
  if (!is.null(df[[i]])) {
    filtered_df <- df[[i]] %>%
      anti_join(min_ACC_list[[i]], by = "Subject") 
    
    file_path <- paste0("../../4_Data_Extraction/4_3_Clean_Data/df_", i, "_filtered.csv")
    
    if (!file.exists(file_path)) {
      # 如果文件不存在，则创建一个空的文件
      write.csv(
        x = data.frame(),  # 创建一个空的数据框
        file = file_path,
        row.names = FALSE
      )
    }
    
    
    # 追加数据到文件末尾
    write.csv(
      x = filtered_df,
      file = file_path,
      row.names = FALSE,
    )
    
    cat("Filtered data for df[[", i, "]] has been appended to ", file_path, "\n")
  } else {
    cat("df[[", i, "]] is empty.\n")
  }
}

rm(filtered_df, i, file_path)

```

#Vsrsion 01
```{r}
# 定义计算d'的函数
calculate_d_prime <- function(Hit_rate, False_alarm_rate) {
  d_prime <- qnorm(Hit_rate) - qnorm(False_alarm_rate)
  return(d_prime)
}

# 1. 报告不同Matching、Nonmatching条件下各种Identity的RT、ACC
library(dplyr)

result1 <- combined_data %>%
  group_by(Paper, Matching, Identity) %>%
  summarize(mean_RT = mean(RT_ms),
            mean_ACC = mean(ACC),
            .groups = 'drop')  # 设置.groups参数为'drop'，取消组信息输出

# 2. 分析Identity的Self条件下的信号检测论中的d'
self_data <- combined_data %>%
  filter(Identity == "Self")

# Calculate d' for Self condition
d_prime_self <- calculate_d_prime(mean(self_data$ACC[self_data$Matching == "Matching"]),
                                  1 - mean(self_data$ACC[self_data$Matching == "Nonmatching"])) # 此处改为"Nonmatching"

# 3. 分析Identity的其他条件下的信号检测论中的d'
other_data <- combined_data %>%
  filter(Identity != "Self")

# Calculate d' for other conditions
d_prime_other <- calculate_d_prime(mean(other_data$ACC[other_data$Matching == "Matching"]),
                                   1 - mean(other_data$ACC[other_data$Matching == "Nonmatching"])) # 此处改为"Nonmatching"

# 4. 将每个Paper的数据整合，并输出为一个表，要求方便可读
result_table <- combined_data %>%
  group_by(Paper) %>%
  summarize(mean_RT = mean(RT_ms),
            mean_ACC = mean(ACC),
            d_prime = ifelse(Identity == "Self", d_prime_self, d_prime_other),
            .groups = 'drop')  # 设置.groups参数为'drop'，取消组信息输出

# 输出结果
print("1. 报告不同Matching、Nonmatching条件下各种Identity的RT、ACC")
print(result1)

print("2. Identity的Self条件下的信号检测论中的d'")
print(d_prime_self)

print("3. Identity的其他条件下的信号检测论中的d'")
print(d_prime_other)

print("4. 每个Paper的数据整合")
print(result_table)

# 清除临时变量
rm(d_prime_other, d_prime_self)

```
#Version 02
```{r}
# 定义计算d'的函数
calculate_d_prime <- function(Hit_rate, False_alarm_rate) {
  d_prime <- qnorm(Hit_rate) - qnorm(False_alarm_rate)
  return(d_prime)
}

# 函数：计算d'值
compute_d_prime <- function(data, identity_type) {
  self_data <- data %>%
    filter(Identity == identity_type)
  d_prime <- calculate_d_prime(mean(self_data$ACC[self_data$Matching == "Matching"]),
                                1 - mean(self_data$ACC[self_data$Matching == "Nonmatching"]))
  return(d_prime)
}

# 函数：计算各种Identity的RT和ACC
compute_rt_acc <- function(data) {
  result <- data %>%
    group_by(Paper, Matching, Identity) %>%
    summarize(mean_RT = mean(RT_ms),
              mean_ACC = mean(ACC),
              .groups = 'drop')
  return(result)
}

# 1. 报告不同Matching、Nonmatching条件下各种Identity的RT、ACC
result1 <- compute_rt_acc(combined_data)

# 2. 计算Identity的Self条件下的d'值
d_prime_self <- compute_d_prime(combined_data, "Self")

# 3. 计算Identity的非Self条件下的d'值
d_prime_other <- compute_d_prime(combined_data, "Stranger")

# 4. 将每个Paper的数据整合，并输出为一个表
result_table <- combined_data %>%
  group_by(Paper) %>%
  summarize(mean_RT = mean(RT_ms),
            mean_ACC = mean(ACC),
            d_prime = ifelse(Identity == "Self", d_prime_self, d_prime_other),
            .groups = 'drop')

# 输出结果
print("1. 报告不同Matching、Nonmatching条件下各种Identity的RT、ACC")
print(result1)

print("2. Identity的Self条件下的信号检测论中的d'")
print(d_prime_self)

print("3. Identity的其他条件下的信号检测论中的d'")
print(d_prime_other)

print("4. 每个Paper的数据整合")
print(result_table)

# 清除临时变量
rm(d_prime_other, d_prime_self)

```
#Version 03
```{r}
# 定义计算d'的函数
calculate_d_prime <- function(Hit_rate, False_alarm_rate) {
  d_prime <- qnorm(Hit_rate) - qnorm(False_alarm_rate)
  return(d_prime)
}

# 函数：计算d'值
# 函数：根据数据计算d'值
compute_d_prime <- function(data) {
  d_prime <- data %>%
    summarize(d_prime = calculate_d_prime(mean(ACC[Matching == "Matching"]),
                                          1 - mean(ACC[Matching == "Nonmatching"])))
  return(d_prime$d_prime)
}

# 函数：计算各种Identity的RT和ACC
compute_rt_acc <- function(data) {
  result <- data %>%
    group_by(Paper, Matching, Identity) %>%
    summarize(mean_RT = mean(RT_ms),
              mean_ACC = mean(ACC),
              .groups = 'drop')
  return(result)
}

# 1. 报告不同Matching、Nonmatching条件下各种Identity的RT、ACC
result1 <- compute_rt_acc(combined_data)

# 2. 根据Paper计算每个Paper的d'值
d_prime_per_paper <- combined_data %>%
  group_by(Paper) %>%
  summarize(d_prime = compute_d_prime(.))

# 3. 将每个Paper的数据整合，并输出为一个表
result_table <- combined_data %>%
  group_by(Paper) %>%
  summarize(mean_RT = mean(RT_ms),
            mean_ACC = mean(ACC),
            .groups = 'drop') %>%
  left_join(d_prime_per_paper, by = "Paper")

# 输出结果
print("1. 报告不同Matching、Nonmatching条件下各种Identity的RT、ACC")
print(result1)

print("2. 每个Paper的d'值")
print(d_prime_per_paper)

print("3. 每个Paper的数据整合")
print(result_table)

```

#Version 04
```{r}
# 定义计算d'的函数
compute_d_prime <- function(data) {
  message("Computing d' for Paper ", unique(data$Paper))
  d_prime <- calculate_d_prime(mean(data$ACC[data$Matching == "Matching"]),
                               1 - mean(data$ACC[data$Matching == "Nonmatching"]))
  return(d_prime)
}

# 函数：根据数据计算d'值
compute_d_prime <- function(data) {
  d_prime <- data %>%
    summarize(d_prime = calculate_d_prime(mean(ACC[Matching == "Matching"]),
                                          1 - mean(ACC[Matching == "Nonmatching"])))
  return(d_prime$d_prime)
}


# 函数：计算各种Identity的RT和ACC
compute_rt_acc <- function(data) {
  result <- data %>%
    group_by(Paper, Matching, Identity) %>%
    summarize(mean_RT = mean(RT_ms),
              mean_ACC = mean(ACC),
              .groups = 'drop')
  return(result)
}

# 1. 报告不同Matching、Nonmatching条件下各种Identity的RT、ACC
result1 <- compute_rt_acc(combined_data)

# 2. 根据Paper计算每个Paper的d'值
d_prime_per_paper <- combined_data %>%
  group_by(Paper) %>%
  summarize(d_prime = compute_d_prime(.))  # 计算每个Paper的d'值

# 3. 将每个Paper的数据整合，并输出为一个表
result_table <- combined_data %>%
  group_by(Paper) %>%
  summarize(mean_RT = mean(RT_ms),
            mean_ACC = mean(ACC),
            .groups = 'drop') %>%
  left_join(d_prime_per_paper, by = "Paper")

# 输出结果
print("1. 报告不同Matching、Nonmatching条件下各种Identity的RT、ACC")
print(result1)

print("2. 每个Paper的d'值")
print(d_prime_per_paper)

print("3. 每个Paper的数据整合")
print(result_table)

```
#Version 05
```{r}
# 定义计算d'的函数
calculate_d_prime <- function(Hit_rate, False_alarm_rate) {
  d_prime <- qnorm(Hit_rate) - qnorm(False_alarm_rate)
  return(d_prime)
}

# 函数：根据数据计算d'值
compute_d_prime <- function(data, identity_type) {
  d_prime <- data %>%
    summarize(d_prime = calculate_d_prime(mean(ACC[Matching == "Matching" & Identity == identity_type]),
                                          1 - mean(ACC[Matching == "Nonmatching" & Identity == identity_type])))
  return(d_prime$d_prime)
}

# 函数：计算各种Identity的RT和ACC
compute_rt_acc <- function(data) {
  result <- data %>%
    group_by(Paper, Matching, Identity) %>%
    summarize(mean_RT = mean(RT_ms),
              mean_ACC = mean(ACC),
              .groups = 'drop')
  return(result)
}

# 1. 报告不同Matching、Nonmatching条件下各种Identity的RT、ACC
result1 <- compute_rt_acc(combined_data)

# 2. 根据Paper计算每个Paper的d'值（Self）
d_prime_self_per_paper <- combined_data %>%
  filter(Identity == "Self") %>%
  group_by(Paper) %>%
  summarize(d_prime_self = compute_d_prime(., "Self"))  # 计算每个Paper的d'值（Self）

# 3. 根据Paper计算每个Paper的d'值（非Self）
d_prime_other_per_paper <- combined_data %>%
  filter(Identity != "Self") %>%
  group_by(Paper) %>%
  summarize(d_prime_other = compute_d_prime(., "Stranger"))  # 计算每个Paper的d'值（非Self）

# 将两个结果合并为一个表
d_prime_per_paper <- left_join(d_prime_self_per_paper, d_prime_other_per_paper, by = "Paper")

# 4. 将每个Paper的数据整合，并输出为一个表
result_table <- combined_data %>%
  group_by(Paper) %>%
  summarize(mean_RT = mean(RT_ms),
            mean_ACC = mean(ACC),
            .groups = 'drop') %>%
  left_join(d_prime_per_paper, by = "Paper")

# 输出结果
print("1. 报告不同Matching、Nonmatching条件下各种Identity的RT、ACC")
print(result1)

print("2. 每个Paper的d'值（Self）")
print(d_prime_self_per_paper)

print("3. 每个Paper的d'值（非Self）")
print(d_prime_other_per_paper)

print("4. 每个Paper的数据整合")
print(result_table)

```

#d'
```{r}
# 定义计算d'的函数
calculate_d_prime <- function(Hit_rate, False_alarm_rate) {
  d_prime <- qnorm(Hit_rate) - qnorm(False_alarm_rate)
  return(d_prime)
}

# 函数：根据数据计算d'值
compute_d_prime <- function(data, identity_type) {
  d_prime <- data %>%
    summarize(d_prime = calculate_d_prime(mean(ACC[Matching == "Matching" & Identity == identity_type]),
                                          1 - mean(ACC[Matching == "Nonmatching" & Identity == identity_type])))
  return(d_prime$d_prime)
}

# 函数：计算各种Identity的RT和ACC
compute_rt_acc <- function(data) {
  result <- data %>%
    group_by(Paper, Matching, Identity) %>%
    summarize(mean_RT = mean(RT_ms),
              mean_ACC = mean(ACC),
              .groups = 'drop')
  return(result)
}

# 1. 报告不同Matching、Nonmatching条件下各种Identity的RT、ACC
result1 <- compute_rt_acc(combined_data)

# 2. 根据Paper计算每个Paper的d'值（Self）
d_prime_self_per_paper <- combined_data %>%
  group_by(Paper) %>%
  summarize(d_prime_self = compute_d_prime(., "Self"))  # 计算每个Paper的d'值（Self）

# 3. 根据Paper计算每个Paper的d'值（非Self）
d_prime_other_per_paper <- combined_data %>%
  group_by(Paper) %>%
  summarize(d_prime_other = compute_d_prime(., "Stranger"))  # 计算每个Paper的d'值（非Self）

# 将两个结果合并为一个表
d_prime_per_paper <- left_join(d_prime_self_per_paper, d_prime_other_per_paper, by = "Paper")

# 输出结果
print("1. 报告不同Matching、Nonmatching条件下各种Identity的RT、ACC")
print(result1)

print("2. 每个Paper的d'值（Self和非Self）")
print(d_prime_per_paper)

```


#Version 06
```{r}
# 定义计算d'的函数
calculate_d_prime <- function(Hit_rate, False_alarm_rate) {
  d_prime <- qnorm(Hit_rate) - qnorm(False_alarm_rate)
  return(d_prime)
}

# 函数：根据数据计算d'值
compute_d_prime <- function(data, matching_type, identity_type) {
  d_prime <- data %>%
    filter(Matching == matching_type & Identity == identity_type) %>%
    summarize(d_prime = calculate_d_prime(mean(ACC),
                                          1 - mean(ACC)))
  if (length(d_prime$d_prime) != 1) {
    return(NA)  # 如果计算结果的长度不为1，则返回NA
  } else {
    return(d_prime$d_prime)
  }
}

# 函数：计算各种Identity的RT和ACC
compute_rt_acc <- function(data) {
  result <- data %>%
    group_by(Paper, Matching, Identity) %>%
    summarize(mean_RT = mean(RT_ms),
              mean_ACC = mean(ACC),
              .groups = 'drop')
  return(result)
}

# 1. 报告不同Matching、Nonmatching条件下各种Identity的RT、ACC
result1 <- compute_rt_acc(combined_data)

# 2. 根据Paper计算每个Paper的d'值
d_prime_per_paper <- combined_data %>%
  group_by(Paper) %>%
  summarize(
    d_prime_matching_self = compute_d_prime(., "Matching", "Self"),
    d_prime_nonmatching_self = compute_d_prime(., "Nonmatching", "Self"),
    d_prime_matching_other = compute_d_prime(., "Matching", "Stranger"),
    d_prime_nonmatching_other = compute_d_prime(., "Nonmatching", "Stranger")
  )  # 计算每个Paper的d'值

# 输出结果
print("1. 报告不同Matching、Nonmatching条件下各种Identity的RT、ACC")
print(result1)

print("2. 每个Paper的d'值")
print(d_prime_per_paper)


```

#Version 07
```{r}
# 定义计算d'的函数
calculate_d_prime <- function(Hit_rate, False_alarm_rate) {
  d_prime <- qnorm(Hit_rate) - qnorm(False_alarm_rate)
  return(d_prime)
}

# 函数：根据数据计算d'值
compute_d_prime <- function(data, matching_type, identity_type) {
  d_prime <- data %>%
    filter(Matching == matching_type & Identity == identity_type) %>%
    summarize(d_prime = calculate_d_prime(mean(ACC),
                                          1 - mean(ACC)))
  if (length(d_prime$d_prime) != 1) {
    return(NA)  # 如果计算结果的长度不为1，则返回NA
  } else {
    return(d_prime$d_prime)
  }
}

# 函数：计算各种Identity的RT和ACC
compute_rt_acc <- function(data) {
  result <- data %>%
    group_by(Paper, Matching, Identity) %>%
    summarize(mean_RT = mean(RT_ms),
              mean_ACC = mean(ACC),
              .groups = 'drop')
  return(result)
}

# 1. 报告不同Matching、Nonmatching条件下各种Identity的RT、ACC
result1 <- compute_rt_acc(combined_data)

# 2. 根据Paper计算每个Paper的d'值
d_prime_per_paper <- combined_data %>%
  group_by(Paper) %>%
  summarise(
    d_prime_matching_self = compute_d_prime(combined_data, "Matching", "Self"),
    d_prime_nonmatching_self = compute_d_prime(combined_data, "Nonmatching", "Self"),
    d_prime_matching_other = compute_d_prime(combined_data, "Matching", "Stranger"),
    d_prime_nonmatching_other = compute_d_prime(combined_data, "Nonmatching", "Stranger")
  )  # 计算每个Paper的d'值

# 输出结果
print("1. 报告不同Matching、Nonmatching条件下各种Identity的RT、ACC")
print(result1)

print("2. 每个Paper的d'值")
print(d_prime_per_paper)


```

#Version 08
```{r}
# 函数：根据数据计算d'值
compute_d_prime <- function(data, matching_type, identity_type) {
  d_prime <- data %>%
    filter(Matching == matching_type & Identity == identity_type) %>%
    summarize(d_prime = calculate_d_prime(mean(ACC),
                                          1 - mean(ACC)))
  if (length(d_prime$d_prime) != 1) {
    return(NA)  # 如果计算结果的长度不为1，则返回NA
  } else {
    return(d_prime$d_prime)
  }
}

# 函数：计算各种Identity的RT和ACC
compute_rt_acc <- function(data) {
  result <- data %>%
    group_by(Paper, Matching, Identity) %>%
    summarize(mean_RT = mean(RT_ms),
              mean_ACC = mean(ACC),
              .groups = 'drop')
  return(result)
}

# 1. 报告不同Matching、Nonmatching条件下各种Identity的RT、ACC
result1 <- compute_rt_acc(combined_data)

# 2. 根据Paper计算每个Paper的d'值
d_prime_per_paper <- lapply(unique(combined_data$Paper), function(paper) {
  tibble(
    Paper = paper,
    d_prime_matching_self = compute_d_prime(filter(combined_data, Paper == paper), "Matching", "Self"),
    d_prime_nonmatching_self = compute_d_prime(filter(combined_data, Paper == paper), "Nonmatching", "Self"),
    d_prime_matching_other = compute_d_prime(filter(combined_data, Paper == paper), "Matching", "Stranger"),
    d_prime_nonmatching_other = compute_d_prime(filter(combined_data, Paper == paper), "Nonmatching", "Stranger")
  )
}) %>%
  bind_rows()  # 组合每个Paper的d'值结果

# 输出结果
print("1. 报告不同Matching、Nonmatching条件下各种Identity的RT、ACC")
print(result1)

print("2. 每个Paper的d'值")
print(d_prime_per_paper)



```

#Version 09
```{r}
# 定义计算d'的函数
calculate_d_prime <- function(Hit_rate, False_alarm_rate) {
  d_prime <- qnorm(Hit_rate) - qnorm(False_alarm_rate)
  return(d_prime)
}

# 函数：根据数据计算d'值
compute_d_prime <- function(data, matching_type, identity_type) {
  d_prime <- data %>%
    filter(Matching == matching_type & Identity == identity_type) %>%
    summarize(d_prime = calculate_d_prime(mean(ACC),
                                          1 - mean(ACC)))
  if (length(d_prime$d_prime) != 1) {
    return(NA)  # 如果计算结果的长度不为1，则返回NA
  } else {
    return(d_prime$d_prime)
  }
}

# 函数：计算各种Identity的RT和ACC
compute_rt_acc <- function(data) {
  result <- data %>%
    group_by(Paper, Matching, Identity) %>%
    summarize(mean_RT = mean(RT_ms),
              mean_ACC = mean(ACC),
              .groups = 'drop')
  return(result)
}

# 1. 报告不同Matching、Nonmatching条件下各种Identity的RT、ACC
result1 <- compute_rt_acc(combined_data)

# 2. 根据Paper计算每个Paper的d'值
d_prime_per_paper <- lapply(unique(combined_data$Paper), function(paper) {
  tibble(
    Paper = paper,
    d_prime_matching_self = compute_d_prime(filter(combined_data, Paper == paper), "Matching", "Self"),
    d_prime_nonmatching_self = compute_d_prime(filter(combined_data, Paper == paper), "Nonmatching", "Self"),
    d_prime_matching_other = compute_d_prime(filter(combined_data, Paper == paper), "Matching", "Stranger"),
    d_prime_nonmatching_other = compute_d_prime(filter(combined_data, Paper == paper), "Nonmatching", "Stranger")
  )
}) %>%
  bind_rows()  # 组合每个Paper的d'值结果

# 输出结果
print("1. 报告不同Matching、Nonmatching条件下各种Identity的RT、ACC")
print(result1)

print("2. 每个Paper的d'值")
print(d_prime_per_paper)

```

#Version 10
```{r}
# 定义计算d'的函数
calculate_d_prime <- function(Hit_rate, False_alarm_rate) {
  d_prime <- qnorm(Hit_rate) - qnorm(False_alarm_rate)
  return(d_prime)
}

# 函数：根据数据计算d'值
compute_d_prime <- function(data, matching_type, identity_type) {
  d_prime <- data %>%
    filter(Matching == matching_type & Identity == identity_type) %>%
    summarize(d_prime = calculate_d_prime(mean(ACC),
                                          1 - mean(ACC)))
  if (length(d_prime$d_prime) != 1) {
    return(NA)  # 如果计算结果的长度不为1，则返回NA
  } else {
    return(d_prime$d_prime)
  }
}

# 函数：计算各种Identity的RT和ACC
compute_rt_acc <- function(data) {
  result <- data %>%
    group_by(Paper, Matching, Identity) %>%
    summarize(mean_RT = mean(RT_ms),
              mean_ACC = mean(ACC),
              .groups = 'drop')
  return(result)
}

# 将Identity中除了Self外的所有身份都归为Others
combined_data$Identity <- ifelse(combined_data$Identity == "Self", "Self", "Others")

# 1. 报告不同Matching、Nonmatching条件下各种Identity的RT、ACC
result1 <- compute_rt_acc(combined_data)

# 2. 根据Paper计算每个Paper的d'值
d_prime_per_paper <- lapply(unique(combined_data$Paper), function(paper) {
  tibble(
    Paper = paper,
    d_prime_matching_self = compute_d_prime(filter(combined_data, Paper == paper), "Matching", "Self"),
    d_prime_nonmatching_self = compute_d_prime(filter(combined_data, Paper == paper), "Nonmatching", "Self"),
    d_prime_matching_other = compute_d_prime(filter(combined_data, Paper == paper), "Matching", "Others"),
    d_prime_nonmatching_other = compute_d_prime(filter(combined_data, Paper == paper), "Nonmatching", "Others")
  )
}) %>%
  bind_rows()  # 组合每个Paper的d'值结果

# 输出结果
print("1. 报告不同Matching、Nonmatching条件下各种Identity的RT、ACC")
print(result1)

print("2. 每个Paper的d'值")
print(d_prime_per_paper)

```

